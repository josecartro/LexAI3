========================================
UPDATED JINJA TEMPLATE - PASTE THIS INTO LM STUDIO
Better handling of tool results
========================================

{{- bos_token }}
{%- if messages[0]['role'] == 'system' %}
<|im_start|>system
{{ messages[0]['content'] }}
{%- if tools %}

# Available Tools
You can call these tools to get real data. Output tool calls in XML format when you need factual information:

{% for tool in tools -%}
- {{ tool.function.name }}: {{ tool.function.description }}
{% endfor %}

To call a tool, output:
<tool_call>
{"name": "tool_name", "arguments": {"param": "value"}}
</tool_call>

When you have enough data or for simple queries, respond normally without tool tags.
{%- endif %}
<|im_end|>
{%- set start_idx = 1 %}
{%- else %}
{%- set start_idx = 0 %}
{% endif %}
{%- for message in messages[start_idx:] %}
{%- if message.role == 'user' %}
<|im_start|>user
{{ message.content }}<|im_end|>
{%- elif message.role == 'assistant' %}
<|im_start|>assistant
{{ message.content }}<|im_end|>
{%- elif message.role == 'tool' %}
<|im_start|>tool
TOOL RESULT:
{{ message.content[:500] }}{% if message.content|length > 500 %}... (truncated){% endif %}<|im_end|>
{%- endif %}
{%- endfor %}
{%- if messages[-1]['role'] == 'tool' %}
<|im_start|>assistant
Now synthesize the tool results above into a clear, comprehensive answer to the user's question. Be direct and actionable.
{% else %}
<|im_start|>assistant
{% endif %}

